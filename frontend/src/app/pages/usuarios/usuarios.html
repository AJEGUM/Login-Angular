<div class="usuarios-container">
  <!-- Header -->
  <div class="titulo-container">
    <h2>Gestión de Usuarios</h2>
    <button class="btn-add" (click)="abrirModal()">+ Agregar Usuario</button>
  </div>

  <!-- Cards de usuarios -->
  <div class="usuario-card" *ngFor="let usuario of usuarios" (click)="abrirModal(usuario)">
    <div class="usuario-header">
      <span class="usuario-nombre">{{ usuario.nombre }}</span>
    </div>
    <p class="usuario-email">{{ usuario.email }}</p>

    <div class="usuario-rol">
      <span class="rol-badge">{{ usuario.rol || 'Sin rol' }}</span>
    </div>

    <div class="usuario-permisos">
      <span *ngFor="let permiso of usuario.permisos" class="permiso-badge">
        {{ permiso }}
      </span>
    </div>
  </div>
</div>

<!-- Modal (igual al que ya tienes) -->
<div class="modal-backdrop" *ngIf="mostrarModal">
  <div class="modal">
    <div class="modal-header">
      <h3 *ngIf="!modoEdicion">Crear Nuevo Usuario</h3>
      <h3 *ngIf="modoEdicion">Editar Usuario</h3>
      <button class="close-btn" (click)="cerrarModal()">✕</button>
    </div>

    <form (ngSubmit)="modoEdicion ? actualizarUsuario() : registrarUsuario()">
      <div class="form-grid">
        <div>
          <label>Nombre</label>
          <input type="text" [(ngModel)]="usuarioForm.nombre" name="nombre" required />
        </div>
        <div>
          <label>Email</label>
          <input type="email" [(ngModel)]="usuarioForm.email" name="email" required />
        </div>
        <div>
          <label *ngIf="!modoEdicion">Contraseña</label>
          <label *ngIf="modoEdicion">Nueva Contraseña (opcional)</label>
          <input type="password" [(ngModel)]="usuarioForm.clave" name="clave" [required]="!modoEdicion" />
        </div>
        <div class="full-width">
          <label>Rol</label>
          <select [(ngModel)]="usuarioForm.id_rol" name="id_rol" (change)="cargarPermisos()" required>
            <option value="">Selecciona un rol</option>
            <option *ngFor="let rol of roles" [value]="rol.id_rol">{{ rol.nombre }}</option>
          </select>
        </div>
      </div>

      <!-- Permisos dinámicos -->
      <div class="permisos" *ngIf="permisosRolSeleccionado.length > 0">
        <label>Permisos del Rol</label>
        <ul class="permisos-lista">
          <li *ngFor="let permiso of permisosRolSeleccionado">{{ permiso }}</li>
        </ul>
      </div>

      <!-- Botones -->
      <div class="modal-actions">
        <button type="submit" class="btn-submit">
          {{ modoEdicion ? 'Guardar Cambios' : 'Crear Usuario' }}
        </button>

        <button *ngIf="modoEdicion" type="button" class="btn-delete" (click)="eliminarUsuario()">
          Eliminar Usuario
        </button>
      </div>
    </form>
  </div>
</div>
